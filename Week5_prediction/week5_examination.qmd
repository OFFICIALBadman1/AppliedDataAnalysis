---
title: "Week 5 Examination Assignment: Asphalt Data Regression"
author: "Isak Jonsson Zachari"
date: "2025-05-06"
format: html
---

# Introduction
This document presents the solutions to the WeekÂ 5 examination assignment for Regression and Prediction, using the `Asphalt_Data.xls` dataset. We perform descriptive analysis, build simple and multiple regression models, conduct stepwise selection, check model adequacy, identify influential observations, and provide recommendations.

â€¢ X1: The viscosity of the asphalt (log)
â€¢ X2: The percentage of asphalt in the surface course
â€¢ X3: The percentage of asphalt in the base course
â€¢ X4: Is the run, an indicator variable separating the 31 pavements into two sets.
â€¢ X5: The percentage of fines in the surface course
â€¢ X6: The percentage of voids in the surface cours

```{r setup}
library(readxl)
library(ggplot2)
library(dplyr)

# Load and clean the data
asphalt_raw <- read_excel("Asphalt_Data.xls")
asphalt <- asphalt_raw %>%
  rename(
    rut_depth = yi,
    viscosity = xi1,
    pct_asph_surf = xi2,
    pct_asph_base = xi3,
    run_set_dummy = xi4,
    pct_fines = xi5,
    pct_voids = xi6,
    log_visc = xi1_Log
  )

colnames(asphalt)
```


# TaskÂ 1: Descriptive Analysis of the Data

## 1.1 Summary Statistics
```{r summary-stats}
summary(asphalt)




#Beroende variabeln har hÃ¶gt meddelvÃ¤rde, medan medianen Ã¶r pÃ¥ 3.580
```

## 1.2 Visualizations. 4 plots
Correlation matrix
```{r }
library(corrplot)
# Compute correlation matrix
cor_mat <- cor(asphalt)
# Plot correlation matrix
title("Correlation Matrix of Asphalt Variables")
corrplot(cor_mat, method = "color", addCoef.col = "black", tl.cex = 0.8)

#De som korrelarer mest posetivt med beroende variabeln Ã¤r pct_asph_surf, lÃ¥g postiv korrelation pÃ¥ 0.24, sen ocksÃ¥ pct_asph_base med 0.21.

#mycket neg korrelation Ã¤r log_viso med -0.88 ochj run_set_dummy med -0.81.,
#pct_voids har mÃ¥ttlig negativ korrealtion. 
```
```{r histograms}
# Distribution of rut depth (Y)
ggplot(asphalt, aes(x = rut_depth)) +
  geom_histogram(bins=10) +
  labs(title = "Distribution of Rut Depth (Y)", x = "Rut depth per million-wheel passes (y)")

# Ser inte bra ut ingen tydlig fÃ¶rdelning
```


```{r}
# Scatter: rut_depth vs log_visc
ggplot(asphalt, aes(x = log_visc, y = rut_depth)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Rut Depth vs Log(Viscosity)", x = "Log of Viscosity")
```

```{r}
# Scatter: rut_depth vs pct_asph_surf
ggplot(asphalt, aes(x = pct_asph_surf, y = rut_depth)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "% Asphalt in Surface Course vs Rut Depth", x = "% Asphalt in Surface Course")
``` 

```{r}
# Scatter: rut_depth vs pct_voids
ggplot(asphalt, aes(x = pct_voids, y = rut_depth)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "% Voids in Surface Course vs Rut Depth", x = "% Voids in Surface Course")
```


> **Findings from Descriptive Analysis:**
Summary statistics: rut_depth, beroende variabeln: Varierar frÃ¥n 0.26 till 26.2 per million weel passes, har en median pÃ¥ 3.58 och medelvÃ¤rde pÃ¥ 6.51. Detta ineikderar en snedfÃ¶rdelad hÃ¶ger fÃ¶rdelning. Viscotity varierar frÃ¥n 0.6 till 500 cP, vilket indikerar att log transofmraitonen va rmkt lÃ¤mplig. log_visc blir mer symmetrisk med medelvÃ¤rde pÃ¥ 2.73 ca. De andra har inte lika stora intervall, och Ã¤r omkring sitt medelvÃ¤rde.  
> - **Summary Statistics:** `rut_depth` ranges from 0.26 to 26.2 per million-wheel passes, with a median of 3.58 and mean of 6.

> - **Histogram of Rut Depth:** Denna visar hÃ¤r en kraftig hÃ¶gersvans vilket stÃ¤rker det jag skrev tidigare. Finns nÃ¥gra extrema vÃ¤rden, men dom flesta Ã¤r i det lÃ¤gre intervallet. VÃ¤ll extremvÃ¤rderna som drrar upp medelvÃ¤rdet rejÃ¤lt. 
.
> - **Rut Depth vs Log(Viscosity):** Visar en stark negativ linjÃ¤r trend, vilket indikerar att hÃ¶gre (logaritmisk) viskositet avsevÃ¤rt minskar spÃ¥rdjupet. 

> - **Rut Depth vs % Asphalt in Surface Course:** Visar ett mÃ¥ttligt positivt samband, vilket tyder pÃ¥ att belÃ¤ggningar med nÃ¥got mer asfalt i ytskiktet tenderar att uppvisa hÃ¶gre spÃ¥rdjup. 

> - **Rut Depth vs % Voids in Surface Course:** Uppvisar ett tydligt negativt samband. 


# TaskÂ 2: Simple Linear Regression Models

VÃ¤ljer fÃ¶ljande tvÃ¥ variablar: 

- **log_visc** har en Pearsonkorrelation pÃ¥ â€“0.88 med spÃ¥rdjupet (`rut_depth`), vilket indikerar en stark negativ linjÃ¤r relation: ju hÃ¶gre log(viskositet), desto mindre spÃ¥rdjup, vilket vi vill uppnÃ¥. 

- VÃ¤ljer ocksÃ¥ pct_voids dÃ¥ den hade negativ korerlation pÃ¥ -0.42

## 2.1 ModelÂ 1: \( y \sim \mathrm{log_visc} \)
```{r}
model1 <- lm(rut_depth ~ log_visc, data = asphalt)
summary(model1)
```

> - **t-value** for `log_visc`: [-10.21]  
> - **P-value** for `log_visc`: [4.152e-11]  
> - **R-squared**: [0.7822 pÃ¥ R^2 samt Adjusted R-squared: 0.7747, vilket Ã¤r nÃ¤ra varrandra och Ã¤r en bra indikation]  
> 
> Modellen fÃ¶rklarar ca 78,22â€¯% av den totala variationen i spÃ¥rdjup. Det betyder att nÃ¤stan 4 av 5 delar av variationen i rut_depth kan hÃ¤nfÃ¶ras till variationen i log(viskositet) i denna enkla modell vilket Ã¤r bra!

## 2.2 ModelÂ 2: \( y \sim pct_voids \)
```{r}
model2 <- lm(rut_depth ~ pct_voids, data = asphalt)
summary(model2)
```

> - **t-value** for `X2`: [-2.521]  
> - **P-value** for `X2`: [0.01747]  
> - **R-squared**: [Multiple R-squared:  0.1797, Adjusted R-squared:  0.1514]  


## 2.3 Model Comparison


Jag skulle rekommendera Modellâ€¯1 framfÃ¶r Modellâ€¯2, av fÃ¶ljande skÃ¤l:
HÃ¶gre fÃ¶rklaringsgrad: 
ğ‘…2= 78,2, samt Adj-R = 77.47, mot R2=17.97% mycket lÃ¥gt. 

Samt sÃ¥ sÃ¤ger P vÃ¤rdet att vi kan fÃ¶rkasta nollhypotesen om att log_visc inte har nÃ¥gon sifnifikant effekt pÃ¥ spÃ¥rdjupet. 
AlltsÃ¥ det finns bevis att sÃ¤ga att den har det. Med pâ€¯â‰ˆâ€¯4Â·10â»Â¹Â¹ (mycket mindre Ã¤n <â€¯0,001) pÃ¥ 0.1 % signifikansnivÃ¥ Ã¤r  alltsÃ¥ fÃ¶rkastar vi Hâ‚€ och accepterar att koefficienten Ã¤r signifikant skild frÃ¥n noll.



# TaskÂ 3: Multiple Regression Model with All Variables

anvÃ¤nder alla prediktors (with `log_visc` istÃ¤llet fÃ¶r of `viscosity`):
```{r}
model_all <- lm(rut_depth ~ log_visc + pct_asph_surf + pct_asph_base + run_set_dummy + pct_fines + pct_voids, data = asphalt)
summary(model_all)
```

Analys: 
Tâ€‘vÃ¤rden och pâ€‘vÃ¤rden fÃ¶r koefficienterna

(Intercept): tâ€¯=â€¯â€“0,592, pâ€¯=â€¯0,5597

log_visc: tâ€¯=â€¯â€“3,428, pâ€¯=â€¯0,0022â€¯**

pct_asph_surf: tâ€¯=â€¯+1,590, pâ€¯=â€¯0,1248

pct_asph_base: tâ€¯=â€¯+0,318, pâ€¯=â€¯0,7531

run_set_dummy: tâ€¯=â€¯+0,539, pâ€¯=â€¯0,5949

pct_fines: tâ€¯=â€¯+0,115, pâ€¯=â€¯0,9094

pct_voids: tâ€¯=â€¯+0,445, pâ€¯=â€¯0,6604

*Endast log_visc Ã¤r signifikant pÃ¥ 1â€¯%-nivÃ¥n (pâ€¯<â€¯0,01).

FÃ¶rklaringsgrad: 
FÃ¶rklarar ca 80% av variationen i fÃ¶rklarande variabeln, men antaligen overfittad pga stort glapp till R^2(adj).


JÃ¤mfÃ¶rsles med multipel modell?
R^2 Ã¶kar marginellt frÃ¥n 78,2â€¯% (modellâ€¯1) till 80,6â€¯%, men R2(adj)  sjunker frÃ¥n 77,47â€¯% till 75,75â€¯%.Vilket inte Ã¤r posetivt. 

Endast log_visc bidrar signifikant i den multipla modellen; Ã¶vriga variabler ger inte tillrÃ¤cklig extra fÃ¶rklaringskraft fÃ¶r att motivera sin medtagning.

Slutsats: Den enkla modellen med log_visc Ã¤r att fÃ¶redra, genom att den nÃ¤stan lika fÃ¶rklaringsstark och statistiskt tydligare Ã¤n den fulla multipla modellen. Den multipla blir mer komplex och overfittad. 



# TaskÂ 4: Stepwise Regression
```{r stepwise-regression}
step_model <- step(model_all, direction = "both")
summary(step_model)
```


Stegvis regression (model_step)
# Regressorer borttagna: pct_fines, pct_asph_base, pct_voids, run_set_dummy
# Anledning: varje borttagning minskade AIC-vÃ¤rdet, vilket visar att variabeln gav lÃ¥g extra fÃ¶rklaringsgrad
BestÃ¤mningskoefficient (RÂ²):
#   - Multiple RÂ² = 0.7995
#   - Adjusted RÂ² = 0.7852
Modelluttryck:
#   Å· = -2.3545 + (-2.6914)*log_visc + 3.3203*pct_asph_surf
Modellkontroll?
#   Ja, eftersom den Ã¶vergripande F-testet Ã¤r signifikant (p â‰ˆ 1.69e-10),
#   men vi bÃ¶r kontrollera residualantaganden dÃ¥ pct_asph_surf ej Ã¤r signifikant (p = 0.131).



# TaskÂ 5: Model Adequacy Checking
```{r residual-plots, fig.height=6, fig.width=6}
par(mfrow = c(2, 2))
plot(step_model)
```

Modellantaganden och residualanalys:
1. LinjÃ¤ritet: I Residuals vs Fitted bÃ¶r medelvÃ¤rdet av residualerna ligga runt noll och inga tydliga mÃ¶nster (bÃ¶jar eller systematiska avvikelser) syns.
2. Homoskedasticitet (konstant varians): I Scale-Location (sqrt(|res|) vs fitted) ska punkterna spridas jÃ¤mnt utan en vÃ¤xande trend Ã¶ver fitted-vÃ¤rden.
3. Normalitet: I Q-Q-plot ska punkterna fÃ¶lja den diagonala linjen; stora avvikelser i Ã¤ndarna  kan indikera avvikande svansar.
4. Oberoende & pÃ¥verkan: I Residuals vs Leverage identifieras observationer med hÃ¶gt inflytande.
Punkter utanfÃ¶r Cookâ€™s-avstÃ¥ndet (stippen) Ã¤r potentiellt inflytelserika.




# TaskÂ 6: influens vÃ¤rden diagnostik
```{r}
cooks <- cooks.distance(step_model)
plot(cooks, type = "h", main = "Cook's Distance")
abline(h = 4/(nrow(asphalt) - length(coef(step_model))), col = "red")
influential_points <- which(cooks > 4/(nrow(asphalt) - length(coef(step_model))))
influential_points
```




# Task 6.1: Kommentar efter influensdiagnostik
```{r}
# PÃ¥visade inflytelserika vÃ¤rden:
#   - Endast observation 13 har Cook's distance Ã¶ver trÃ¶skelvÃ¤rdet.
# Rekommendation:
#   1. Granska datapunkten 13 fÃ¶r eventuella inmatningsfel eller extrema fÃ¶rhÃ¥llanden.
#   2. KÃ¶r modellen utan denna punkt fÃ¶r att se hur koefficienter och RÂ² fÃ¶rÃ¤ndras.
#   3. Baserat pÃ¥ domÃ¤nkunskap besluta om punkten ska exkluderas eller behÃ¥llas.
```



7. Skulle jag rekommmendera modellen frÃ¥n frÃ¥ga 6? 
# Jag rekommenderar att vi anvÃ¤nder den stegvisa modellen (log_visc + pct_asph_surf)
# eftersom den har hÃ¶g fÃ¶rklaringsgrad (RÂ² = 0.7995, justerat RÂ² = 0.7852)
# och endast behÃ¥ller signifikanta och meningsfulla variabler.
# log_visc Ã¤r starkt signifikant (p < 0.001) och pct_asph_surf bidrar praktiskt men kan i nÃ¤sta iteration prÃ¶vas med exempelvis interatkions term log_visc*pct_asph_surf fÃ¶r att se hur residualerna Ã¤ndras


8: Fortsatt arbete och rekommendationer:
1. Datainsamling: Inkludera ytterligare eventuella variablar, kanske temperatur, balestning pÃ¥ vÃ¤garna frÃ¥n trafiken eller annat fÃ¶r att gÃ¶ra modellen bÃ¤ttre och mer nyanserad.  Samt Ã¤nnu mer data det var inte Ã¥s mycket data. 

2. Validering: Kolla hur modellen skulle kunna prestera mot ny data fÃ¶r att bedÃ¶ma hur den faktiskt presterar. 

3. Ã–vervakning: Installera system som mÃ¤ter spÃ¥rdjupet lÃ¶pande, fÃ¶r att uppdatera modellen kontunuerligt och fÃ¥nga mer nyanserade egenskaper i materialen och trafikmÃ¶nster. 






